# Sample Data Scripts

This directory contains scripts for managing sample data in the Charity Shelter
API.

## Available Scripts

### `seed.ts`

This script populates the database with sample data for testing and development
purposes.

#### Sample Data Includes:

1. **Users**
   - Admin User (admin@charityshelter.org / admin123)
   - Manager User (manager@charityshelter.org / manager123)
   - Volunteer User (volunteer@charityshelter.org / volunteer123)

2. **Organizations**
   - Hope Shelter
   - Food Bank Foundation
   - Education for All

3. **Posts**
   - Urgent Need for Winter Clothing (Hope Shelter, type: news)
   - Food Drive Success (Food Bank Foundation, type: article)
   - New Education Center Opening (Education for All, type: announcement)

4. **API Key**
   - A sample API key will be generated and stored

#### How to Run

```bash
deno run --unstable-kv scripts/seed.ts
```

### `export_to_csv.ts`

This script exports all collections from the KV database to CSV files for backup
purposes.

#### Features:

- Exports each KV collection to a separate CSV file
- Automatically creates a `backups` directory to store the exported files
- Uses timestamps in filenames to prevent overwriting previous backups
- Handles different data types appropriately in CSV format
- Provides console output with export statistics

#### How to Run

```bash
deno run --unstable-kv scripts/export_to_csv.ts
```

#### Notes:

- CSV files are saved to the `./backups` directory
- Each file is named in the format: `[COLLECTION_NAME]_[TIMESTAMP].csv`
- Empty collections are skipped

### `import_from_csv.ts`

This script imports data from CSV files back into the KV database, useful for
restoring backups.

#### Features:

- Intelligently parses CSV files and converts values to appropriate data types
- Can import all CSV files in the backup directory or a specific file
- Handles complex data structures like nested JSON objects and arrays
- Validates collection names against existing KV collections
- Automatically identifies ID fields for KV storage
- Provides detailed import statistics

#### How to Run

```bash
# Import all CSV files in the backups directory
deno run --unstable-kv scripts/import_from_csv.ts

# Import a specific CSV file
deno run --unstable-kv scripts/import_from_csv.ts ./backups/users_2025-03-18.csv
```

#### Notes:

- The script assumes CSV files follow the format generated by `export_to_csv.ts`
- The script attempts to detect the appropriate field to use as the key for each
  record
- If a record with the same key already exists in the KV store, it will be
  overwritten

## Sample API Endpoints

After running the seed script, you can test the following endpoints:

1. **Authentication**
   ```bash
   # Login
   curl -X POST http://localhost:8000/api/v1/auth/login \
     -H "Content-Type: application/json" \
     -H "X-API-Key: YOUR_API_KEY" \
     -d '{"email": "admin@charityshelter.org", "password": "admin123"}'
     
   # Verify token
   curl -X POST http://localhost:8000/api/v1/auth/verify \
     -H "Content-Type: application/json" \
     -H "X-API-Key: YOUR_API_KEY" \
     -d '{"token": "YOUR_JWT_TOKEN"}'
   ```

2. **Organizations**
   ```bash
   # List all organizations
   curl http://localhost:8000/api/v1/organizations \
     -H "X-API-Key: YOUR_API_KEY"

   # Get specific organization
   curl http://localhost:8000/api/v1/organizations/org_1 \
     -H "X-API-Key: YOUR_API_KEY"
   ```

3. **Public Posts**
   ```bash
   # List all published posts
   curl http://localhost:8000/api/v1/posts \
     -H "X-API-Key: YOUR_API_KEY"

   # Get specific published post
   curl http://localhost:8000/api/v1/posts/post_1 \
     -H "X-API-Key: YOUR_API_KEY"
     
   # Search published posts
   curl http://localhost:8000/api/v1/posts/search/winter \
     -H "X-API-Key: YOUR_API_KEY"
     
   # Get posts by type
   curl http://localhost:8000/api/v1/posts/type/news \
     -H "X-API-Key: YOUR_API_KEY"
   ```

4. **Admin Posts** (requires admin token)
   ```bash
   # List all posts (both published and unpublished)
   curl http://localhost:8000/api/v1/admin/posts \
     -H "Authorization: Bearer YOUR_ADMIN_TOKEN" \
     -H "X-API-Key: YOUR_API_KEY"
     
   # Create new post
   curl -X POST http://localhost:8000/api/v1/admin/posts \
     -H "Content-Type: application/json" \
     -H "Authorization: Bearer YOUR_ADMIN_TOKEN" \
     -H "X-API-Key: YOUR_API_KEY" \
     -d '{"title": "New Post", "content": "Post content...", "type": "news", "isPublished": true}'
     
   # Update existing post
   curl -X PUT http://localhost:8000/api/v1/admin/posts/post_1 \
     -H "Content-Type: application/json" \
     -H "Authorization: Bearer YOUR_ADMIN_TOKEN" \
     -H "X-API-Key: YOUR_API_KEY" \
     -d '{"title": "Updated Title", "content": "Updated content...", "type": "news"}'
     
   # Publish/unpublish post
   curl -X PATCH http://localhost:8000/api/v1/admin/posts/post_3/publish \
     -H "Content-Type: application/json" \
     -H "Authorization: Bearer YOUR_ADMIN_TOKEN" \
     -H "X-API-Key: YOUR_API_KEY" \
     -d '{"isPublished": true}'
   ```

5. **Admin Routes** (requires admin token)
   ```bash
   # List all users
   curl http://localhost:8000/api/v1/admin/users \
     -H "Authorization: Bearer YOUR_ADMIN_TOKEN" \
     -H "X-API-Key: YOUR_API_KEY"
     
   # API analytics
   curl http://localhost:8000/api/v1/admin/analytics/summary \
     -H "Authorization: Bearer YOUR_ADMIN_TOKEN" \
     -H "X-API-Key: YOUR_API_KEY"
   ```

6. **Analytics Endpoints**
   ```bash
   # Track post view
   curl -X POST http://localhost:8000/api/analytics/view \
     -H "Content-Type: application/json" \
     -H "X-API-Key: YOUR_API_KEY" \
     -d '{"postId": "post_1", "sessionId": "session123", "referrer": "https://example.com", "userAgent": "Mozilla/5.0"}'
     
   # Get post analytics
   curl http://localhost:8000/api/analytics/posts/post_1 \
     -H "X-API-Key: YOUR_API_KEY"
   ```

## Notes

- The scripts use the same JWT secret as defined in your environment variables
- All passwords are hashed using bcrypt
- The API key will be displayed in the console after running the seed script
- Make sure your server is running before testing the endpoints
- The API now follows a versioned structure with `/api/v1/` prefix for most
  endpoints
- Posts are separated into public routes (no authentication required) and admin
  routes (authentication required)
